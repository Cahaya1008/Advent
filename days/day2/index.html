      if (type && type.startsWith("key-")) {
        const id = type.split("-")[1];
        if (!inventoryKeys.has(id)) {
          inventoryKeys.add(id);
          setStatus(
            `You picked up key ${String.fromCharCode(
              65 + Number(id)
            )}. Somewhere a matching lock waits.`,
            "good"
          );
        }
        grid[r][c] = "floor";
        if (cellEl) cellEl.classList.remove("key");
      }

      // NEW: when stepping onto a lock we *have* the key for, open it
      if (type && type.startsWith("lock-")) {
        const id = type.split("-")[1];
        if (inventoryKeys.has(id)) {
          grid[r][c] = "floor";
          if (cellEl) cellEl.classList.remove("lock");
          setStatus(
            `Door ${String.fromCharCode(
              65 + Number(id)
            )} swings open. You can pass.`,
            "good"
          );
        }
        // If we *didn't* have the key, isWalkable would have blocked us
        // from entering this tile in the first place.
      }
