<!doctype html>
<html lang="en">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Day 10 — Sudoku</title>
<style>
  body{margin:0;font-family:Inter,Arial;background:linear-gradient(180deg,#041226,#072238);color:#fff;padding:18px}
  .wrap{max-width:820px;margin:0 auto}
  .grid{display:grid;grid-template-columns:repeat(9,44px);gap:2px;padding:6px;border-radius:8px;background:#cfe3ff}
  .cell{width:44px;height:44px;text-align:center;border:1px solid #7ea7ff;border-radius:4px;font-weight:700;background:#fff;color:#102035;font-size:16px}
  /* thick borders for 3x3 boxes */
  .cell.bleft{border-left:3px solid #000}
  .cell.btop{border-top:3px solid #000}
  .cell.bright{border-right:3px solid #000}
  .cell.bbot{border-bottom:3px solid #000}
  .controls{margin-top:10px}
  button{background:#ffd98a;border:0;padding:8px 12px;border-radius:8px;color:#072;font-weight:800}
  .muted{color:#b9cfe6}
  .found{margin-top:12px;background:#fff;color:#072;padding:10px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
</style>
</head>
<body>
<div class="wrap">
  <h2>Day 10 — Sudoku (9×9)</h2>
  <p class="muted">Fill the grid. Use up to 3 hints; revealed numbers persist. Reset clears only your entries (hints stay).</p>
  <div id="grid" class="grid"></div>
  <div class="controls">
    <button id="reset">Reset</button>
    <button id="hint">Hint (<span id="hintLeft">3</span>)</button>
    <button id="exit">Exit</button>
  </div>
  <div id="msg" class="muted" style="margin-top:8px"></div>
  <div id="foundPanel" style="display:none" class="found"><div>Letter found: <strong id="foundLetter">U</strong></div><div><button id="closeFound">Close</button></div></div>
</div>

<script>
/* Day 10 Sudoku */
const DAY = 10;
const COLLECT_LETTER = 'U';
const puzzle = [
  [5,3,0,0,7,0,0,0,0],
  [6,0,0,1,9,5,0,0,0],
  [0,9,8,0,0,0,0,6,0],
  [8,0,0,0,6,0,0,0,3],
  [4,0,0,8,0,3,0,0,1],
  [7,0,0,0,2,0,0,0,6],
  [0,6,0,0,0,0,2,8,0],
  [0,0,0,4,1,9,0,0,5],
  [0,0,0,0,8,0,0,7,9]
];
const solution = [
  [5,3,4,6,7,8,9,1,2],
  [6,7,2,1,9,5,3,4,8],
  [1,9,8,3,4,2,5,6,7],
  [8,5,9,7,6,1,4,2,3],
  [4,2,6,8,5,3,7,9,1],
  [7,1,3,9,2,4,8,5,6],
  [9,6,1,5,3,7,2,8,4],
  [2,8,7,4,1,9,6,3,5],
  [3,4,5,2,8,6,1,7,9]
];

const gridEl = document.getElementById('grid');
let hintLeft = Number(localStorage.getItem('day10_hints') || 3);
document.getElementById('hintLeft').textContent = hintLeft;

const revealedKey = 'day10_revealed';
let revealed = JSON.parse(localStorage.getItem(revealedKey) || '{}'); // "r-c": value

function makeGrid(){
  gridEl.innerHTML = '';
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      const inp = document.createElement('input'); inp.type='text'; inp.maxLength=1; inp.className='cell';
      inp.dataset.r = r; inp.dataset.c = c;
      // thick borders for 3x3 boxes
      if(c%3===0) inp.classList.add('bleft');
      if(r%3===0) inp.classList.add('btop');
      if(c===8) inp.classList.add('bright');
      if(r===8) inp.classList.add('bbot');

      const key = `${r}-${c}`;
      if(revealed[key]){ inp.value = revealed[key]; inp.disabled = true; }
      else if(puzzle[r][c] && puzzle[r][c] !== 0){ inp.value = puzzle[r][c]; inp.disabled=true; }
      else inp.value = '';
      inp.addEventListener('input', ()=>{ inp.value = inp.value.replace(/[^1-9]/g,''); checkComplete(); });
      gridEl.appendChild(inp);
    }
  }
}

function checkComplete(){
  const cells = Array.from(gridEl.querySelectorAll('input'));
  for(const inp of cells) if(inp.value.trim() === '') return false;
  // verify
  for(const inp of cells){
    const r = parseInt(inp.dataset.r), c = parseInt(inp.dataset.c);
    if(parseInt(inp.value) !== solution[r][c]) return false;
  }
  // solved
  try{ if(window.parent && window.parent.collectLetterFromDay) window.parent.collectLetterFromDay(DAY, COLLECT_LETTER); else window.parent.postMessage({type:'collected', day:DAY, value:COLLECT_LETTER}, '*'); }catch(e){ window.parent.postMessage({type:'collected', day:DAY, value:COLLECT_LETTER}, '*'); }
  document.getElementById('foundLetter').textContent = COLLECT_LETTER;
  document.getElementById('foundPanel').style.display = 'flex';
  return true;
}

document.getElementById('reset').addEventListener('click', ()=>{
  // keep revealed hints, clear other entries
  const cells = Array.from(gridEl.querySelectorAll('input'));
  for(const inp of cells){
    const r = inp.dataset.r, c = inp.dataset.c;
    const key = `${r}-${c}`;
    if(puzzle[r][c] && puzzle[r][c] !== 0) continue;
    if(revealed[key]){ inp.value = revealed[key]; inp.disabled=true; }
    else inp.value = '';
  }
  document.getElementById('msg').textContent = 'Grid reset (hint reveals kept).';
});

document.getElementById('hint').addEventListener('click', ()=>{
  if(hintLeft <= 0){ alert('No hints left'); return; }
  // reveal first empty non-prefilled
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      if(puzzle[r][c] && puzzle[r][c] !== 0) continue;
      const key = `${r}-${c}`;
      if(revealed[key]) continue;
      revealed[key] = solution[r][c];
      localStorage.setItem(revealedKey, JSON.stringify(revealed));
      hintLeft = Math.max(0,hintLeft-1);
      localStorage.setItem('day10_hints', hintLeft);
      document.getElementById('hintLeft').textContent = hintLeft;
      makeGrid();
      return;
    }
  }
  alert('No empty cells for hint.');
});

document.getElementById('exit').addEventListener('click', ()=>{ try{ window.parent.hideModal(); }catch(e){ window.parent.postMessage({type:'requestClose'}, '*'); } });
document.getElementById('closeFound').addEventListener('click', ()=>{ try{ window.parent.hideModal(); }catch(e){ window.parent.postMessage({type:'requestClose'}, '*'); } });

makeGrid();
</script>
</body>
</html>
